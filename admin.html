<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wedding Dashboard Elite</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
font-family: -apple-system, BlinkMacSystemFont, sans-serif;
background:#F8F6F2;
padding:20px;
}

.login{
text-align:center;
margin-top:120px;
}

.hidden{display:none;}

.card{
background:white;
padding:20px;
border-radius:20px;
margin:20px 0;
box-shadow:0 10px 30px rgba(0,0,0,0.05);
}

button{
padding:10px 20px;
border:none;
border-radius:30px;
background:black;
color:white;
cursor:pointer;
}

table{
width:100%;
border-collapse:collapse;
margin-top:20px;
}

th,td{
padding:10px;
border-bottom:1px solid #eee;
}

canvas{
margin-top:30px;
}
</style>
</head>
<body>

<div class="login" id="login">
<h2>Acceso Administrador</h2>
<input type="password" id="adminPass" placeholder="Contraseña">
<br><br>
<button onclick="enter()">Entrar</button>
</div>

<div id="dashboard" class="hidden">

<h1>Wedding Tech Elite Dashboard</h1>

<div class="card" id="stats"></div>

<canvas id="grafico"></canvas>

<h2>Lista Invitados</h2>

<table>
<thead>
<tr>
<th>Nombre</th>
<th>Email</th>
<th>Estado</th>
<th>QR</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>

<h2>Escáner QR</h2>
<div id="reader" style="width:300px;"></div>

</div>

<script>

const URL="https://script.google.com/u/2/home/projects/1MFIkNEiBzgV30uVzTU3y_b8Ox0pkKjSvfFSRxq8tVNUvSbW6jM2D_2EU/edit";

function enter(){
if(document.getElementById("adminPass").value==="admin2027"){
document.getElementById("login").classList.add("hidden");
document.getElementById("dashboard").classList.remove("hidden");
loadData();
}
}

function loadData(){
fetch(URL)
.then(res=>res.json())
.then(data=>{

let tbody=document.getElementById("tabla");
tbody.innerHTML="";

let total=0, confirmados=0, no=0;

data.slice(1).forEach(row=>{
total++;
if(row[3]=="Asistiré") confirmados++;
if(row[3]=="No podré asistir") no++;

let tr=document.createElement("tr");
tr.innerHTML=`
<td>${row[1]}</td>
<td>${row[2]}</td>
<td>${row[6]}</td>
<td>
<img src="https://api.qrserver.com/v1/create-qr-code/?size=80x80&data=${URL}?checkin=${row[0]}">
</td>
`;
tbody.appendChild(tr);
});

document.getElementById("stats").innerHTML=
`Total: ${total}<br>
Confirmados: ${confirmados}<br>
No asisten: ${no}`;

renderChart(confirmados, no, total-confirmados-no);
});
}

function renderChart(confirmados, no, pendientes){
new Chart(document.getElementById('grafico'), {
type: 'doughnut',
data: {
labels: ['Confirmados','No asisten','Pendientes'],
datasets: [{
data: [confirmados,no,pendientes],
borderWidth:0
}]
},
options:{
plugins:{
legend:{position:'bottom'}
}
}
});
}

// Escáner QR
function onScanSuccess(decodedText){
fetch(decodedText)
.then(()=>{
alert("Check-in realizado");
loadData();
});
}

new Html5QrcodeScanner(
"reader",
{ fps: 10, qrbox: 250 }
).render(onScanSuccess);

</script>

</body>
</html>
